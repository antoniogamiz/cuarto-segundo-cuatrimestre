\chapter{Derivadas débiles}

Recordemos el espacio $L^1(a,b)$ de las funciones $\funcion{f}{(a,b)}{\R}$ que son Lebesgue integrables. Ese espacio estaba formado por clases de equivalencia, que normalmente llamamos clases de funciones. Que sea Lebesgue integrable, no quiere decir que sea continua, como nos indica la \textit{función de Dirichlet}, que es Lebesgue integrable pero evidentemente no es continua.
\[
f(x)=\left\{
\begin{array}{cc}
0 & x\notin\mathbb{Q} \\
1 & x\in\mathbb{Q}
\end{array}
\right. 
\]
Toda función continua no es integrable, necesitamos que encierre área finita. Eso nos dice que todas las funciones continuas no están en $L^1(a,b)$. Para evitar eso, definimos el \textit{espacio de funciones continuas localmente integrables}, que denotaremos por:
\[
L^1_{loc}(a,b)=\{\funcion{f}{(a,b)}{\R} \;|\; \forall J \text{ intervalo compacto},f_{|J}\text{ es integrable}\}
\]
Ese espacio soluciona el problema anterior ya que todas las funciones continuas sí son localmente integrables. Solucionado el problema, podemos definir la derivada débil con tranquilidad:

\begin{definition}
Sean $f,g\in\localmenteintegrable$, se dice que $g$ es la derivada débil de $f$ si se verifica que:
\[
\integral{a}{b}{f\phi'}+\integral{a}{b}{g\phi}=0 \espacio \forall\phi\in\soportecompacto
\]
\end{definition}

Cabe resaltar, que la definición anterior implica que la derivada débil de una función no es única, es decir, una función $f$ puede admitir varias derivadas débiles. Sin embargo, como veremos en el siguiente corolario, serán iguales para casi todo punto.

\section{Propiedades básicas}

Podemos generalizar el lema fundamental del cálculo de variciones:

\begin{theorem}
Si $f\in\localmenteintegrable$ cumpliendo:
\[
\integral{a}{b}{f(x)\phi(x)dx}=0 \espacio\forall\phi\in\soportecompacto
\]
Entonces $f(x)=0$ $a.e$ $x\in(a,b)$.
\end{theorem}
Este resultado engloba al visto previamente en el teorema \ref{theorem:1.3}. Como consecuencia, tenemos:
\begin{coro}
Sea $f\in\localmenteintegrable$ y $g,\tilde{g}\in\localmenteintegrable$ dos derivadas débiles de $f$. Entonces $g(x)=\tilde{g}(x)$ $a.e$ $x\in(a,b)$.
\end{coro}

\begin{proof}
Simplemente usando la definición y el lema generalizado tenemos:
\[
\left.
\begin{array}{c}
\integral{a}{b}{f\phi'}+\integral{a}{b}{g\phi}=0 \\
\integral{a}{b}{f\phi'}+\integral{a}{b}{\tilde{g}\phi}=0
\end{array}
\right\} \Rightarrow \integral{a}{b}{(g-\tilde{g})\phi}=0 \Rightarrow g=\tilde{g} \; a.e
\]
\end{proof}

Para la demostración del lema generalizado, necesitaremos algunas herramientos previas. Recordemos primeramente una propiedad de las funciones Lebesgue integrables:

\begin{prop}
Dado $f\in\localmenteintegrable$, existe una secuencia de funciones simples, $\{g_n\}$, tal que $\{g_n\}\longrightarrow f$ a.e.
\end{prop}

\begin{lemma}
Sea $g$ una función simple, entonces existe una sucesión de funciones de soporte compacto $\phi_n\in\soportecompacto$ tal que $\{\phi_n\}\longrightarrow g \; a.e$ y además $|\phi_n(x)|\leq|g(x)|$.
\end{lemma}

Ahora ya sí podemos demostrar el lema generalizado:

\begin{proof}
Sea $g$ una función simple. Por el lema anterior, puedo tomar una sucesión $\phi_n$ de funciones de soporte compacto convergiendo a $g$. Usando el teorema de la convergencia dominada de Lebesgue, podemos intercambiar el límite en la siguiente integral:
\[
0=\limitemasinfinito{n}{\integral{}{}{\phi_n(x)f(x)dx}}=\integral{}{}{g(x)f(x)}dx
\]
Por la proposición anterior, nos podemos tomar una sucesión $g_n$ de funciones simples de forma que $\{g_n\}\longrightarrow f \; a.e$. De forma análoga:
\[
0=\limitemasinfinito{n}{\integral{}{}{g_n(x)f(x)dx}}=\integral{}{}{f(x)^2}dx \Rightarrow f\equiv 0 \; a.e
\]
\end{proof}

La derivada débil tiene una propiedad parecida a la derivada clásica, ambas son conceptos locales, es decir:

\begin{prop}
Si $f$ es una función que admite derivada débil $f'=g$ en $(a,b)$, y tomamos $(a',b')\subset(a,b)$, entonces $f_{|(a',b')}$ admite derivada débil y vale $g_{|(a',b')}$.
\end{prop}

\begin{proof}
Evidente usando el hecho de que $\mathcal{D}(a',b')\hookrightarrow\soportecompacto$.
\end{proof}

Toda función derivable débil no es derivable, como ilustra el siguiente ejemplo:

\begin{example}
La función $\funcion{f}{\R}{\R}$ definida por $f(x)=\sqrt{|x|}$, es derivable débil pero no derivable.

\[g(x)=\frac{1}{2\sqrt{x}}\quad \text{para } x>0; \qquad g(x)=\frac{-1}{2\sqrt{-x}}\quad \text{para } x<0\]

Primero tenemos que ver que $g\in\localmenteintegrable$. Si el intervalo compacto $J$ escogido no contiene al 0, entonces podemos integral sin problema. En caso contrario, tenemos que ver qué pasa con la siguiente integral:
\[
\integral{-\varepsilon}{\varepsilon}{|g(x)|dx}\overset{g\; simetrica}{=}2\integral{0}{\varepsilon}{|g(x)|dx}=2\integral{0}{\varepsilon}{\frac{1}{2\sqrt{x}}}=2\sqrt{x}\Big|_0^\varepsilon=2\sqrt{\varepsilon}<+\infty
\]
Ahora tenemos que comprobar que $g$ es la derivada débil de $f$, es decir:
\[
\integral{\R}{}{f\phi'}+\integral{\R}{}{g\phi}=0 \espacio \forall\phi\in\soportecompacto
\]
\[
\integral{\R}{}{f(x)\phi'(x)dx}=\integral{|x|>\varepsilon}{}{f(x)\phi'(x)dx}+\underbrace{\integral{|x|<\varepsilon}{}{f(x)\phi'(x)dx}}_{\leq2\varepsilon\sqrt{\varepsilon}\max|\phi'|\to 0}=\integral{|x|>\varepsilon}{}{f(x)\phi'(x)dx}=
\]
\[
=\integral{-\infty}{-\varepsilon}{f(x)\phi'(x)dx}+\integral{\varepsilon}{+\infty}{f(x)\phi'(x)dx}=
\]
\[
=\underbrace{f(x)\phi(x)\Big|_{-\infty}^{-\varepsilon}}_{=f(-\varepsilon)\phi(-\varepsilon)\to 0}-
\integral{-\infty}{-\varepsilon}{g(x)\phi(x) dx}+
\underbrace{f\phi\Big|_{\varepsilon}^{+\infty}}_{{=f(\varepsilon)\phi(\varepsilon)\to 0}}-
\integral{\varepsilon}{+\infty}{g(x)\phi(x) dx}=
\]
\[
-\integral{\R}{}{g(x)\phi(x)dx}+\underbrace{\integral{|x|<\varepsilon}{}{g(x)\phi(x)dx}}_{\to0}=-\integral{\R}{}{g(x)\phi(x)dx}
\]
\end{example}

Vamos a ver que la derivada de una integral de una derivada débil, es la propia función (como es de esperar). Para ello vamos a tener que desarrollar una serie de pasos previos.

\begin{theorem}
\label{fundamentalcalculo}
Sea $g\in\localmenteintegrable$ y tomo $x_0\in(a,b)$. Defino $\funcion{f}{(a,b)}{\R}$ como
\[
f(x)=\integral{x_0}{x}{g(x)ds}
\]
Entonces $f'=g$ y $f\in C[a,b]$.
\end{theorem}

\begin{proof}

La integral en $f$ tiene sentido ya que $[x_0,x]\subset (a,b)$. Comprobemos que $f\in C(a,b)$. Tomamos $\{x_n\}$ sucesión de puntos de $(x_0,x)$ tal que $x_n\to \tilde{x}\in[x_0,x]$ (por ser compacto).

\begin{center}

\begin{tikzpicture}[scale=0.5]
\draw (-1,0)-- (9,0); %Axis

\draw (0,-.5) -- (0,.5);
\draw (0,-0.5) node[anchor=north] {$a$};

\draw [thick] (2.1,-.5) -- (2,-.5) -- (2,.5) -- (2.1,.5); 
\draw (2,-.5) node [anchor=north] {$x_0$};

\draw (3.5,-.5) -- (3.5,.5);
\draw (3.5,-0.5) node[anchor=north] {$x_n$};

\draw (4.5,-.5) -- (4.5,.5);
\draw (4.5,-0.5) node[anchor=north] {$\tilde{x}$};

\draw [thick] (6,-.5) -- (6.1,-.5) -- (6.1,.5) -- (6,.5); 
\draw (6,-.5) node [anchor=north] {$x$};

\draw (8,-.5) -- (8,.5);
\draw (8,-0.5) node[anchor=north] {$b$};

\end{tikzpicture}
\end{center}

\begin{enumerate}[-]
\item Si $x\notin[x_0,\tilde{x}] \Rightarrow x\notin [x_0,x_n]$ para $n\geq n_0$.
\item Si $x\in(x_0,\tilde{x}) \Rightarrow x\in [x_0,x_n]$ para $n\geq n_0$.
\end{enumerate}

Y ese es la clave que nos va a permitir ver que $f(x_n)\to f(\tilde{x})$. Sea $J$ un intervalo compacto de forma que $[x_0,x]\subset J\subset(a,b)$.
\[
\integral{x_0}{x_n}{g(x)dx}=\integral{J}{}{g(x)\chi_{[x_0,x_n]}}(x)dx
\]
Usando lo anterior obtenemos la convergencia puntual de la sucesión $g(x)\chi_{[x_0,x_n]}\overset{cp}{\longrightarrow}g(x)\chi_{(x_0,\tilde{x})}$. Lo que nos da la convergencia en integral también:
\[
f(x_n)=\integral{J}{}{g(x)\chi_{[x_0,x_n]}(x)dx}\longrightarrow\integral{J}{}{g(x)\chi_{(x_0,\tilde{x})}(x)dx}=\integral{x_0}{\tilde{x}}{g(x)dx}=f(\tilde{x})
\]
Luego $f\in C(a,b) \Rightarrow f\in \localmenteintegrable$.
Ahora nos queda ver $f'=g$. Para ello tenemos que comprobar que:
\[
\integral{a}{b}{f(x)\phi'(x)dx}+\integral{a}{b}{g(x)\phi(x)dx}=0 \espacio \forall \phi\in \soportecompacto
\]
Tenemos el problema de que $g$ no tiene por qué ser derivable (podría ser una función escalón, por ejemplo). Vamos a empezar suponiendo que $g\in L^1([a,b])$ (para que $f$ esté bien definida) y que $x_0=a$. Al final reduciremos esas hipótesis hasta llegar a que $g\in\localmenteintegrable$.

\underline{Paso 1}: $g\in L^1([a,b])$ y $x_0=a$. Para ver que
\[
\integral{a}{b}{f(x)\phi'(x)dx}=-\integral{a}{b}{g(x)\phi(x)dx} 
\]
vamos a tener que usar el Teorema de Fubini-Tonelli.
\[
\integral{a}{b}{f(x)\phi'(x)dx}=
\integral{a}{b}{\left(\integral{a}{x}{g(s)ds}\right)\phi'(x)dx}\overset{TªFT}{=}
\integral{a}{b}{\left(\integral{s}{b}{g(s)\phi'(x)dx}\right)ds}=\]
\[
\integral{a}{b}{g(s)\left(\integral{s}{b}{\phi'(x)dx}\right)ds}
=\integral{a}{b}{g(s)(\underbrace{\phi(b)}_{=0}-\phi(s))ds}=-\integral{a}{b}{g(s)\phi'(s)ds}
\]
\underline{Paso 2}: Reemplazamos la hipótesis $x_0=a$ por $x_0\in(a,b)$ y usamos el paso 1:
\[
\integral{a}{b}{g(x)\phi(x)dx}=-\integral{a}{b}{\left(\integral{a}{x}{g(s)ds}\right)\phi'(x)dx}
\]
Vemos que la integral del interior se puede expresar como una constante más una función:
\[
\integral{a}{x}{g(s)ds}=\underbrace{\integral{a}{x_0}{g(s)ds}}_{cte=C}+\underbrace{\integral{x_0}{x}{g(s)ds}}_{funcion}
\]
Luego:
\[
-\integral{a}{b}{\left(\integral{a}{x}{g(s)ds}\right)\phi'(x)dx}=
-\underbrace{\integral{a}{b}{B\phi'(x)dx}}_{=B(\phi(b)-\phi(a))=0}-\integral{a}{b}{\left(\integral{x_0}{x}{g(s)ds}\right)\phi'(x)dx}=
-\integral{a}{b}{f(x)\phi(x)dx}
\]
\underline{Paso 3}: Ahora sustituimos la hipótesis $g\in L^1([a,b])$ por $g\in\localmenteintegrable$. Tomamos un subintervalo compacto $[a'.b']\subset(a,b)$ donde $g_{|[a'.b']}\in L^1([a',b'])$, de forma que $\supp\phi\subset[a',b']$. Sea $x_0\in[a',b']$ y $x\in(a,b)$.

Ahora aplicamos el caso 2, usando que $\supp\phi\subset[a',b']$:
\[
\integral{a}{b}{g(x)\phi(x)dx}=\integral{a'}{b'}{g(x)\phi(x)dx}=-\integral{a'}{b'}{\left(\integral{x_0}{x}{g(s)ds}\right)\phi'(x)dx}=-\integral{a}{b}{f(x)\phi'(x)dx}
\]
\end{proof}

Una vez obtenida una versión para derivadas débiles del Teorema Fundamental del Cálculo, vamos a ver más propiedades de este concepto.

La siguiente proposición nos permitirá obtener un representante continuo a partir de una función que tenga derivada débil, pero no tengo por qué ser continua.

\begin{prop}
\label{representantecontinuo}
Si $f\in\localmenteintegrable$ tiene derivada débil en $(a,b)$, entonces existe $\tilde{f}\in C(a,b)$ tal que $\tilde{f}(x)=f(x)$ $a.e$ $x\in(a,b)$.
\end{prop}

\begin{proof}
Sea $f\in\localmenteintegrable$, $\funcion{g}{(a,b)}{\R}$ su derivda débil, es decir, $f'=g$ y $x_0\in(a,b)$. Definimos $\funcion{\tilde{f}}{(a,b)}{\R}$ por:
\[
\tilde{f}(x)=\integral{x_0}{x}{g(s)ds}
\]
El resultado anterior nos da que $\tilde{f}\in C(a,b)$ y $\tilde{f}'=g$. Solo nos falta ver que $\tilde{f}$ es igual casi por doquier a $f$ salvo una constante, o lo que es lo mismo, comprobar que $f-\tilde{f}$ tiene derivada débil 0:
\[
\left.
\begin{array}{cc}
\integral{a}{b}{f(x)\phi'(x)dx}=-\integral{a}{b}{g(x)dx} \\
\integral{a}{b}{\tilde{f}(x)\phi'(x)dx}=-\integral{a}{b}{g(x)dx}
\end{array}
\right\} \Rightarrow \integral{a}{b}{(f-\tilde{f})(x)\phi'(x)}=-\integral{a}{b}{0\phi(x)dx}
\]
\end{proof}

\begin{prop}
\label{derivadadebilcero}
Si $f\in\localmenteintegrable$ y tiene derivada débil igual a 0, entonces $f$ es constante $\casipordoquier$.
\end{prop}

\begin{proof}
La demostración de este es prácticamente igual a la demostración del Lema \ref{lemma:14}.
\end{proof}

\begin{example}[examen 18/19]
Sea $\funcion{f}{\R\backslash\{1\}}{\R}$ definida por $f(x)=\frac{(x-1)(x+2)}{|x-1|}$. ¿Tiene derivada débil?

Nos damos cuenta de que $f(x)=\frac{(x-1)(x+2)}{|x-1|}=\frac{x-1}{|x-1|}(x+2)$, es decir, $f$ se expresa como producto de una función escalón (discontinua), por un polinomio (continuo), luego $f$ es discontinua.

Como es discontinua, si tuviera derivada débil, por la proposición \ref{representantecontinuo} , debe existir $\tilde{f}$ función continua tal que $f(x)=\tilde{f}(x)\;\; a.e$. Veamos que esa función no puede existir. El conjunto $\{x:\;\; f(x)=\tilde{f}(x)\}$ tiene \textbf{medida llena} (complementario con medida nula), luego es denso. Tomamos $\{x_n\}\longrightarrow 1$ y vemos que:
\[
3=\limite{n}{1^+}{f(x_n)}=\limite{n}{1^+}{\tilde{f}(x_n)}
\]
\[
-3=\limite{n}{1^-}{f(x_n)}=\limite{n}{1^-}{\tilde{f}(x_n)}
\]
Pero $\tilde{f}$ es continua, luego esos límites deberían coincidir: contradicción.

\end{example}

\begin{prop}
\label{derivadanesima}
Sea $f\in\localmenteintegrable$ $n$-veces derivable débil, entonces existe $\tilde{f}$ tal que $f(x)=\tilde{f}(x) \; \casipordoquier$ y además $\tilde{f}\in C^{n-1}(a,b)$.
\end{prop}

\begin{proof}
\underline{Caso n=1}: Si $f$ tiene derivada débil, sabemos por la proposición \ref{representantecontinuo} que existe $\tilde{f}\in C(a,b)$ y $f(x)=\tilde{f}(x) \;\casipordoquier$.
Se deduce fácilmente del siguiente hecho:
\[
\left.
\begin{array}{r}
\integral{a}{b}{\tilde{f}(x)\phi'(x)dx}+\integral{a}{b}{g(x)\phi(x)dx}=0 \\
\tilde{f}, g \text{ continuas }
\end{array}
\right\} \Rightarrow \tilde{f}\in C^1(a,b), \;\tilde{f}'=g \text{ (en sentido clásico)}
\]
\underline{Suponemos para $n-1$}: Toda función $n-1$ veces (débilmente) derivable tiene un representante de clase $C^{n-2}$.
\underline{Caso n}: Suponemos que $f$ es $n$-veces derivable débil entonces $f'$ es $n-1$ veces derivable (débil), luego
existe $g\in C^{n-2}$ tal que $f'=g$ a.e. Por otra parte, $f$ tiene derivada débil, luego existe $\tilde{f}$ continua con
$f=\tilde{f}$ a.e. Por tanto tenemos

\[
\left.
\begin{array}{r}
\integral{a}{b}{\tilde{f}(x)\phi'(x)dx}+\integral{a}{b}{g(x)\phi(x)dx}=0 \\
\tilde{f}, g \text{ continuas }
\end{array}
\right\} \Rightarrow \tilde{f}\in C^1(a,b), \;\tilde{f}'=g \text{ (en sentido clásico)}
\]

Y el hecho de que $g\in C^{n-2}$ implica $\tilde{f}\in C^{n-1}$.
\end{proof}

\section{The Devil Staircase}

Nuestro objetivo va a ser construir una función continua$\funcion{f}{\R}{\R}$ que no admita derivada débil.

En $\R\backslash(0,1)$ será constante:
\[
f(x)=\left\{
\begin{array}{cc}
0 & x\leq 0\\
1 & x\geq 1
\end{array}
\right.
\]
En $(0,1)$ nos va a costar un poco más construirla. Para ello, definimos primeramente \textit{el conjunto ternario de Cantor}, que se construye sobre el intervalo $[0,1]$, eliminando en cada paso el segmento abierto correspondiente al tercio central de cada intervalo.

\begin{figure}[h]
   \center
  \includegraphics[scale=0.5]{img/cantor.jpeg}
  \caption{Representación gráfica}
\end{figure}

Es fácil ver que la medida del primer conjunto $C_0$ es $2/3$, el de $C_1$ $4/9$, y el de $C_n=(\frac{2}{3})^n$. Además, cada $C_n$ es compacto, luego si consideramos como conjunto $C$ a la intersección de todos, es decir, $C=\cap_{n\in\N} C_n$, obtenemos otro conjunto compacto. $C$ tiene medida nula, ya que $\mu(C)=\left(\frac{2}{3}\right)^n\to0$.

Vamos a construir nuestra $f$ sobre el complementario de ese conjunto, es decir, sobre $B=(0,1)\backslash C$.

Nuestra función será constante en cada intervalo de $B$, es decir, en los intervalos que hemos sustraído al construir el conjunto ternario de Cantor. Para hacerla continua, necesitamos regularizar cada salto entre intervalos, definiendo $f$ en esa parte como una recta que conecte cada intervalo con el siguiente.

\begin{figure}[H]
   \center
  \includegraphics[scale=0.6]{img/escalera.png}
\end{figure}

Denotamos por $f_n$ a la función resultante de realizar el paso anterior $n$ veces, consiguiéndo así una sucesión de funciones continuas. Esta sucesión cumple además una propiedad clave para nosotros: si $x\in B$, existe un $n_0\in\N$ tal que si $n\geq n_0$, entonces $x$, debe de estar en algún intervalo, $I_{n_0}$. Pero en esos intervalos, que son los eliminados por el conjunto de Cantor, nuestra función es constante, es decir, $f_n$ es constante en $I_{n_0}$.

Una vez realiza esta construcción, podemos definir nuestra función $f$ como sigue:
\[
f(x)=\limitemasinfinito{n}{f_n(x)}
\]
Tenemos que ver que $f_n$ converge para que la definición de $f$ tenga sentido. Debido a la forma en la que hemos construido la sucesión $f_n$, tenemos que:

\begin{figure}[H]
   \center
  \includegraphics[scale=0.6]{img/convergenciaescalera.png}
\end{figure}
\[
\valorabsoluto{f_n(x)-f_{n+1}(x)}\leq\frac{1}{2^n} \Rightarrow \norm{f_n(x)-f_{n+1}}_{\infty}\leq \frac{1}{2^n}
\]

Expresando ahora $f_n$ usando la forma telescópica de una sucesión:
\[
f_n(x)=f_1(x)+f_2(x)-f_1(x)+...=f_1(x)+\sum_{n=1}^\infty\left(f_{n+1}(x)-f_n(x)\right) \Rightarrow \norm{f_n}_{\infty}\leq \frac{1}{2^n}
\]
Obteniendo así que $f_n$ converge uniformemente a $f$, y como $f_n$ es continua para todo $n\in\N$, $f$ también lo es. 

Ya tenemos nuestra \textit{escalera continua} construida, falta ver que no tiene derivada débil. Supongamos que existe $g$ tal que $f'=g$. Como $f$ está definida como una función constante en cada componente conexa de $B$, su derivada vale 0, es decir, $g(x)=0\;$ si $x \in B$ o $x\leq 1$ o $x\leq 0$. Pero, como $B$ tiene medida llena, lo anterior implica que $g(x)=0 \; a.e \; x\in\R$, luego $f$ sería constante, lo cual es una evidente contradicción.
